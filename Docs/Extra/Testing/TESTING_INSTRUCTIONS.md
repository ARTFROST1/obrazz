# ✅ Инструкция по тестированию исправления загрузки гардероба

## Что было исправлено

- ✅ Добавлена rehydration для `wardrobeStore` и `outfitStore` в `_layout.tsx`
- ✅ Добавлена встроенная диагностика базы данных (`wardrobeDiagnostics.ts`)
- ✅ Теперь вещи должны загружаться и отображаться на странице гардероба

## Как проверить исправление

### 1. Перезапуск приложения

```bash
# Остановить текущий сервер (Ctrl+C)
# Очистить кэш и перезапустить
npx expo start --clear
```

### 2. Быстрая проверка через консоль

После запуска приложения откройте DevTools (нажмите `j` в терминале) и в консоли браузера выполните:

```javascript
checkWardrobe();
```

**Ожидаемый результат:** Все проверки показывают ✅ (зелёная галочка)

Если есть проблемы, автоматически исправьте:

```javascript
fixWardrobe();
```

**Подробнее:** См. [WARDROBE_DIAGNOSTICS.md](WARDROBE_DIAGNOSTICS.md)

### 2. Тестирование функционала

#### Тест 1: Загрузка вещей на экране гардероба

1. Откройте приложение
2. Войдите в аккаунт (если не вошли)
3. Перейдите на вкладку "Гардероб"
4. **Ожидается:** Вещи отображаются в сетке

#### Тест 2: Pull-to-refresh

1. На экране гардероба потяните вниз для обновления
2. **Ожидается:** Список вещей обновляется

#### Тест 3: Добавление новой вещи

1. Нажмите "+" на экране гардероба
2. Добавьте новую вещь
3. Вернитесь на экран гардероба
4. **Ожидается:** Новая вещь появилась в списке

#### Тест 4: Создание образа (регрессионный тест)

1. Перейдите на вкладку "Образы"
2. Нажмите "Создать образ"
3. **Ожидается:** Вещи отображаются в Step 1 (Item Selection)

#### Тест 5: Персистентность данных

1. Закройте приложение полностью
2. Откройте приложение заново
3. Перейдите на вкладку "Гардероб"
4. **Ожидается:** Вещи загружаются мгновенно из кэша AsyncStorage

## Консольные логи для проверки

При запуске приложения должны появиться следующие логи:

```
[RootLayoutNav] Rehydrating stores...
[ItemService.getUserItems] Fetching items for user: <user_id>
[ItemService.getUserItems] Fetched items count: <число>
[ItemService.getUserItems] Sample item: { id: ..., name: ..., category: ... }
[ItemService.getUserItems] Returning <число> items
```

## Возможные проблемы и решения

### Проблема: Вещи всё ещё не загружаются

**Решение 1: Очистка AsyncStorage**

```bash
# В терминале Expo Dev Tools
# Нажмите Shift+M → Clear storage
```

**Решение 2: Проверка пользователя**

```typescript
// В консоли Expo должно быть:
console.log(useAuthStore.getState().user?.id); // должен быть ID
```

**Решение 3: Проверка базы данных**

- Откройте Supabase Dashboard
- Перейдите в Table Editor → items
- Проверьте, есть ли записи с вашим user_id

### Проблема: Ошибки TypeScript

```bash
# Проверка типов
npm run type-check

# Если есть ошибки в _layout.tsx, убедитесь что импорты правильные
```

## Итоговый чеклист

- [ ] Приложение запускается без ошибок
- [ ] Логи показывают "Rehydrating stores..."
- [ ] Вещи отображаются на экране гардероба
- [ ] Pull-to-refresh работает
- [ ] Добавление новой вещи работает
- [ ] Создание образа работает (вещи видны)
- [ ] После перезапуска приложения вещи загружаются быстро

## Файлы изменены

1. `app/_layout.tsx` - добавлена rehydration для wardrobeStore и outfitStore
2. `WARDROBE_LOADING_FIX.md` - документация исправления

---

**Если всё работает - проблема решена! ✅**
