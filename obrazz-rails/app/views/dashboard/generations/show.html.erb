<% content_for(:title) { "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è ##{@generation.id} - Obrazz" } %>

<!-- Back Link -->
<div class="mb-6">
  <%= link_to dashboard_generations_path, class: "inline-flex items-center text-sm font-medium text-gray-600 hover:text-gray-900" do %>
    <svg class="mr-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
    </svg>
    –ù–∞–∑–∞–¥ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è–º
  <% end %>
</div>

<div class="lg:grid lg:grid-cols-3 lg:gap-8">
  <!-- Main Image -->
  <div class="lg:col-span-2">
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
      <div class="relative aspect-square">
        <% if @generation.primary_output_url.present? %>
          <img src="<%= @generation.primary_output_url %>" 
               alt="Generation result" 
               class="h-full w-full object-contain bg-gray-50">
               
          <!-- Download Button -->
          <div class="absolute bottom-4 right-4">
            <%= link_to download_dashboard_generation_path(@generation), 
                class: "inline-flex items-center px-4 py-2 rounded-lg bg-white/90 backdrop-blur shadow-lg text-sm font-medium text-gray-900 hover:bg-white transition-colors",
                target: "_blank" do %>
              <svg class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
              </svg>
              –°–∫–∞—á–∞—Ç—å
            <% end %>
          </div>
        <% elsif @generation.status == 'processing' %>
          <div class="h-full w-full flex items-center justify-center bg-gradient-to-br from-purple-50 to-pink-50">
            <div class="text-center">
              <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto"></div>
              <p class="mt-4 text-lg font-medium text-gray-900">–û–±—Ä–∞–±–æ—Ç–∫–∞...</p>
              <p class="mt-1 text-sm text-gray-500">–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 2 –º–∏–Ω—É—Ç</p>
            </div>
          </div>
        <% elsif @generation.status == 'failed' %>
          <div class="h-full w-full flex items-center justify-center bg-red-50">
            <div class="text-center px-8">
              <svg class="h-16 w-16 text-red-400 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
              </svg>
              <p class="mt-4 text-lg font-medium text-red-900">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</p>
              <% if @generation.error_message.present? %>
                <p class="mt-2 text-sm text-red-600"><%= @generation.error_message %></p>
              <% end %>
            </div>
          </div>
        <% else %>
          <div class="h-full w-full flex items-center justify-center bg-gray-100">
            <svg class="h-24 w-24 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  
  <!-- Details Sidebar -->
  <div class="mt-8 lg:mt-0">
    <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
      <div class="p-6">
        <!-- Type & Status -->
        <div class="flex items-center justify-between mb-6">
          <span class="inline-flex items-center rounded-full bg-purple-100 px-3 py-1 text-sm font-medium text-purple-700">
            <% case @generation.generation_type %>
            <% when 'virtual_try_on' %>
              üë§ Virtual Try-On
            <% when 'fashion_model' %>
              ‚ú® Fashion Model
            <% when 'variation' %>
              üîÑ –í–∞—Ä–∏–∞—Ü–∏—è
            <% else %>
              üé® AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è
            <% end %>
          </span>
          
          <% case @generation.status %>
          <% when 'completed' %>
            <span class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">
              –ì–æ—Ç–æ–≤–æ
            </span>
          <% when 'processing' %>
            <span class="inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800">
              –û–±—Ä–∞–±–æ—Ç–∫–∞
            </span>
          <% when 'failed' %>
            <span class="inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800">
              –û—à–∏–±–∫–∞
            </span>
          <% when 'pending' %>
            <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800">
              –û–∂–∏–¥–∞–Ω–∏–µ
            </span>
          <% end %>
        </div>
        
        <!-- Details List -->
        <dl class="space-y-4">
          <div>
            <dt class="text-sm font-medium text-gray-500">ID –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</dt>
            <dd class="mt-1 text-sm text-gray-900 font-mono"><%= @generation.id %></dd>
          </div>
          
          <div>
            <dt class="text-sm font-medium text-gray-500">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @generation.created_at.strftime('%d.%m.%Y –≤ %H:%M') %></dd>
          </div>
          
          <% if @generation.completed_at %>
            <div>
              <dt class="text-sm font-medium text-gray-500">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</dt>
              <dd class="mt-1 text-sm text-gray-900"><%= @generation.completed_at.strftime('%d.%m.%Y –≤ %H:%M') %></dd>
            </div>
          <% end %>
          
          <div>
            <dt class="text-sm font-medium text-gray-500">–¢–æ–∫–µ–Ω—ã</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @generation.tokens_cost %> —Ç–æ–∫–µ–Ω</dd>
          </div>
          
          <% if @generation.input_params.present? && @generation.input_params.is_a?(Hash) %>
            <% if @generation.input_params['prompt'] %>
              <div>
                <dt class="text-sm font-medium text-gray-500">–ü—Ä–æ–º–ø—Ç</dt>
                <dd class="mt-1 text-sm text-gray-900 italic">"<%= @generation.input_params['prompt'] %>"</dd>
              </div>
            <% end %>
          <% end %>
        </dl>
        
        <% if @generation.status == 'failed' && @generation.error_message.present? %>
          <div class="mt-6 p-4 rounded-lg bg-red-50">
            <h4 class="text-sm font-medium text-red-800">–ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏:</h4>
            <p class="mt-1 text-sm text-red-600"><%= @generation.error_message %></p>
          </div>
        <% end %>
      </div>
    </div>
    
    <!-- Input Images (if available) -->
    <% input_images = Array(@generation.input_image_urls).compact %>
    <% if input_images.empty? && @generation.input_params.present? && @generation.input_params.is_a?(Hash) %>
      <% input_images = [@generation.input_params['person_image'], @generation.input_params['garment_image'], @generation.input_params['source_image']].compact %>
    <% end %>
    <% if input_images.any? %>
      <div class="mt-6 bg-white rounded-2xl shadow-lg overflow-hidden">
        <div class="p-6">
          <h3 class="text-sm font-medium text-gray-900 mb-4">–ò—Å—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</h3>
          <div class="grid grid-cols-2 gap-3">
            <% input_images.first(4).each_with_index do |img_url, idx| %>
              <div class="aspect-square rounded-lg overflow-hidden bg-gray-100">
                <img src="<%= img_url %>" alt="Input <%= idx + 1 %>" class="h-full w-full object-cover">
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- Related Generations -->
<% if @related_generations.any? %>
  <div class="mt-12">
    <h2 class="text-lg font-semibold text-gray-900 mb-6">–ü–æ—Ö–æ–∂–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h2>
    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
      <% @related_generations.each do |generation| %>
        <%= link_to dashboard_generation_path(generation), class: "group" do %>
          <div class="aspect-square rounded-xl overflow-hidden bg-gray-100">
            <% if generation.primary_output_url.present? %>
              <img src="<%= generation.primary_output_url %>" 
                   alt="Generation" 
                   class="h-full w-full object-cover group-hover:scale-105 transition-transform duration-300">
            <% else %>
              <div class="h-full w-full flex items-center justify-center">
                <svg class="h-8 w-8 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>
