<% content_for(:title) { 'Настройки - Obrazz' } %>

<!-- Page Header -->
<div class="mb-8">
  <h1 class="text-2xl font-bold leading-7 text-[#1A1A2E] sm:truncate sm:text-3xl sm:tracking-tight">
    Настройки профиля
  </h1>
  <p class="mt-1 text-sm text-[#666666]">
    Управляйте данными вашего аккаунта
  </p>
</div>

<div class="lg:grid lg:grid-cols-3 lg:gap-8">
  <!-- Sidebar Navigation -->
  <div class="lg:col-span-1">
    <nav class="space-y-1">
      <%= link_to dashboard_settings_path, 
          class: "group flex items-center px-4 py-3 text-sm font-medium rounded-xl transition-colors #{'bg-[#1A1A2E] text-white' if action_name == 'show'} #{'text-[#666666] hover:bg-[#F5F5F5]' unless action_name == 'show'}" do %>
        <svg class="mr-3 h-5 w-5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
        </svg>
        Профиль
      <% end %>
      
      <%= link_to notifications_dashboard_settings_path, 
          class: "group flex items-center px-4 py-3 text-sm font-medium rounded-xl transition-colors #{'bg-[#1A1A2E] text-white' if action_name == 'notifications'} #{'text-[#666666] hover:bg-[#F5F5F5]' unless action_name == 'notifications'}" do %>
        <svg class="mr-3 h-5 w-5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
        </svg>
        Уведомления
      <% end %>
    </nav>
  </div>
  
  <!-- Main Content -->
  <div class="mt-8 lg:mt-0 lg:col-span-2 space-y-6">
    <!-- Profile Form -->
    <div class="bg-white rounded-2xl border border-[#E5E5E5] overflow-hidden">
      <%= form_with model: @user, url: dashboard_settings_path, method: :patch do |f| %>
        <div class="p-6 sm:p-8">
          <h2 class="text-lg font-semibold text-[#1A1A2E] mb-6">Информация профиля</h2>
          
          <div class="space-y-6">
            <!-- Avatar -->
            <div class="flex items-center">
              <% if @user.avatar_url.present? %>
                <img class="h-20 w-20 rounded-full object-cover border-2 border-[#E5E5E5]" src="<%= @user.avatar_url %>" alt="">
              <% else %>
                <div class="h-20 w-20 rounded-full bg-[#1A1A2E] flex items-center justify-center">
                  <span class="text-white text-2xl font-bold">
                    <%= (@user.full_name || @user.email || 'U').first.upcase %>
                  </span>
                </div>
              <% end %>
              <div class="ml-5">
                <p class="text-sm text-[#999999]">Аватар загружается через мобильное приложение</p>
              </div>
            </div>
            
            <!-- Email (Read-only) -->
            <div>
              <label class="block text-sm font-medium text-[#1A1A2E] mb-2">Email</label>
              <input type="email" 
                     value="<%= @user.email %>" 
                     disabled
                     class="block w-full rounded-xl border-[#E5E5E5] bg-[#F5F5F5] px-4 py-3 text-sm text-[#999999] cursor-not-allowed">
              <p class="mt-1.5 text-xs text-[#999999]">Email нельзя изменить</p>
            </div>
            
            <!-- Username -->
            <div>
              <label for="username" class="block text-sm font-medium text-[#1A1A2E] mb-2">Имя пользователя</label>
              <%= f.text_field :username, 
                  class: "block w-full rounded-xl border-[#E5E5E5] bg-[#F5F5F5] px-4 py-3 text-sm text-[#1A1A2E] placeholder-[#999999] focus:border-[#1A1A2E] focus:ring-[#1A1A2E] focus:bg-white transition-colors",
                  placeholder: "username" %>
            </div>
            
            <!-- Full Name -->
            <div>
              <label for="full_name" class="block text-sm font-medium text-[#1A1A2E] mb-2">Полное имя</label>
              <%= f.text_field :full_name, 
                  class: "block w-full rounded-xl border-[#E5E5E5] bg-[#F5F5F5] px-4 py-3 text-sm text-[#1A1A2E] placeholder-[#999999] focus:border-[#1A1A2E] focus:ring-[#1A1A2E] focus:bg-white transition-colors",
                  placeholder: "Иван Иванов" %>
            </div>
          </div>
        </div>
        
        <!-- Save Button -->
        <div class="px-6 py-4 bg-[#FAFAFA] border-t border-[#E5E5E5] flex justify-end">
          <%= f.submit 'Сохранить изменения', 
              class: "inline-flex justify-center rounded-full bg-[#1A1A2E] py-3 px-6 text-sm font-semibold text-white hover:opacity-90 transition-opacity cursor-pointer" %>
        </div>
      <% end %>
    </div>
    
    <!-- Account Info -->
    <div class="bg-white rounded-2xl border border-[#E5E5E5] overflow-hidden">
      <div class="p-6 sm:p-8">
        <h2 class="text-lg font-semibold text-[#1A1A2E] mb-6">Информация об аккаунте</h2>
        
        <dl class="space-y-4">
          <div class="flex justify-between items-center py-3 border-b border-[#F5F5F5]">
            <dt class="text-sm text-[#666666]">ID аккаунта</dt>
            <dd class="text-sm font-mono text-[#1A1A2E] bg-[#F5F5F5] px-3 py-1 rounded-lg"><%= @user.id %></dd>
          </div>
          <div class="flex justify-between items-center py-3 border-b border-[#F5F5F5]">
            <dt class="text-sm text-[#666666]">Supabase ID</dt>
            <dd class="text-sm font-mono text-[#1A1A2E] bg-[#F5F5F5] px-3 py-1 rounded-lg truncate max-w-[200px]" title="<%= @user.supabase_id %>">
              <%= @user.supabase_id&.truncate(16) %>
            </dd>
          </div>
          <div class="flex justify-between items-center py-3 border-b border-[#F5F5F5]">
            <dt class="text-sm text-[#666666]">Дата регистрации</dt>
            <dd class="text-sm text-[#1A1A2E]"><%= @user.created_at.strftime('%d.%m.%Y') %></dd>
          </div>
          <div class="flex justify-between items-center py-3">
            <dt class="text-sm text-[#666666]">Последняя активность</dt>
            <dd class="text-sm text-[#1A1A2E]"><%= @user.last_active_at&.strftime('%d.%m.%Y %H:%M') || '—' %></dd>
          </div>
        </dl>
      </div>
    </div>
    
    <!-- Danger Zone -->
    <div class="bg-white rounded-2xl border border-[#FF3B30]/30 overflow-hidden">
      <div class="p-6 sm:p-8">
        <h2 class="text-lg font-semibold text-[#FF3B30] mb-2">Опасная зона</h2>
        <p class="text-sm text-[#666666] mb-6">Эти действия необратимы. Будьте осторожны.</p>
        
        <div class="flex items-center justify-between p-4 bg-[#FF3B30]/5 rounded-xl">
          <div>
            <h3 class="text-sm font-semibold text-[#1A1A2E]">Удалить аккаунт</h3>
            <p class="text-sm text-[#666666]">Все ваши данные будут удалены навсегда</p>
          </div>
          <%= button_to 'Удалить аккаунт', 
              destroy_account_dashboard_settings_path,
              method: :delete,
              data: { turbo_confirm: 'Вы уверены? Это действие необратимо. Все ваши данные, генерации и подписка будут удалены.' },
              class: "inline-flex items-center rounded-full bg-[#FF3B30] px-5 py-2.5 text-sm font-semibold text-white hover:opacity-90 transition-opacity" %>
        </div>
      </div>
    </div>
  </div>
</div>
