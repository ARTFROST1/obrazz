<% content_for(:title) { 'Настройки - Obrazz' } %>

<!-- Page Header -->
<div class="mb-8">
  <h1 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
    Настройки профиля
  </h1>
  <p class="mt-1 text-sm text-gray-500">
    Управляйте данными вашего аккаунта
  </p>
</div>

<div class="lg:grid lg:grid-cols-3 lg:gap-8">
  <!-- Sidebar Navigation -->
  <div class="lg:col-span-1">
    <nav class="space-y-1">
      <%= link_to dashboard_settings_path, 
          class: "group flex items-center px-3 py-2 text-sm font-medium rounded-md #{'bg-purple-50 text-purple-700' if action_name == 'show'}" do %>
        <svg class="mr-3 h-5 w-5 flex-shrink-0 <%= 'text-purple-500' if action_name == 'show' %>" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
        </svg>
        Профиль
      <% end %>
      
      <%= link_to notifications_dashboard_settings_path, 
          class: "group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900 #{'bg-purple-50 text-purple-700' if action_name == 'notifications'}" do %>
        <svg class="mr-3 h-5 w-5 flex-shrink-0 text-gray-400 group-hover:text-gray-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
        </svg>
        Уведомления
      <% end %>
    </nav>
  </div>
  
  <!-- Main Content -->
  <div class="mt-8 lg:mt-0 lg:col-span-2">
    <div class="bg-white shadow rounded-xl overflow-hidden">
      <%= form_with model: @user, url: dashboard_settings_path, method: :patch, class: "divide-y divide-gray-200" do |f| %>
        <!-- Profile Section -->
        <div class="p-6 sm:p-8">
          <h2 class="text-lg font-medium text-gray-900 mb-6">Информация профиля</h2>
          
          <div class="space-y-6">
            <!-- Avatar -->
            <div class="flex items-center">
              <% if @user.avatar_url.present? %>
                <img class="h-20 w-20 rounded-full object-cover" src="<%= @user.avatar_url %>" alt="">
              <% else %>
                <div class="h-20 w-20 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
                  <span class="text-white text-2xl font-bold">
                    <%= (@user.full_name || @user.email || 'U').first.upcase %>
                  </span>
                </div>
              <% end %>
              <div class="ml-5">
                <p class="text-sm text-gray-500">Аватар загружается через мобильное приложение</p>
              </div>
            </div>
            
            <!-- Email (Read-only) -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Email</label>
              <div class="mt-1">
                <input type="email" 
                       value="<%= @user.email %>" 
                       disabled
                       class="block w-full rounded-md border-gray-300 bg-gray-50 shadow-sm sm:text-sm cursor-not-allowed">
              </div>
              <p class="mt-1 text-xs text-gray-500">Email нельзя изменить</p>
            </div>
            
            <!-- Username -->
            <div>
              <label for="username" class="block text-sm font-medium text-gray-700">Имя пользователя</label>
              <div class="mt-1">
                <%= f.text_field :username, 
                    class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm",
                    placeholder: "username" %>
              </div>
            </div>
            
            <!-- Full Name -->
            <div>
              <label for="full_name" class="block text-sm font-medium text-gray-700">Полное имя</label>
              <div class="mt-1">
                <%= f.text_field :full_name, 
                    class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm",
                    placeholder: "Иван Иванов" %>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Save Button -->
        <div class="px-6 py-4 bg-gray-50 flex justify-end">
          <%= f.submit 'Сохранить', 
              class: "inline-flex justify-center rounded-md border border-transparent bg-purple-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2" %>
        </div>
      <% end %>
    </div>
    
    <!-- Danger Zone -->
    <div class="mt-8 bg-white shadow rounded-xl overflow-hidden border border-red-200">
      <div class="p-6 sm:p-8">
        <h2 class="text-lg font-medium text-red-600 mb-2">Опасная зона</h2>
        <p class="text-sm text-gray-500 mb-6">Эти действия необратимы. Будьте осторожны.</p>
        
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-sm font-medium text-gray-900">Удалить аккаунт</h3>
            <p class="text-sm text-gray-500">Все ваши данные будут удалены навсегда</p>
          </div>
          <%= button_to 'Удалить аккаунт', 
              destroy_account_dashboard_settings_path,
              method: :delete,
              data: { turbo_confirm: 'Вы уверены? Это действие необратимо. Все ваши данные, генерации и подписка будут удалены.' },
              class: "inline-flex items-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500" %>
        </div>
      </div>
    </div>
    
    <!-- Account Info -->
    <div class="mt-8 bg-white shadow rounded-xl overflow-hidden">
      <div class="p-6 sm:p-8">
        <h2 class="text-lg font-medium text-gray-900 mb-6">Информация об аккаунте</h2>
        
        <dl class="space-y-4">
          <div class="flex justify-between">
            <dt class="text-sm text-gray-500">ID аккаунта</dt>
            <dd class="text-sm font-mono text-gray-900"><%= @user.id %></dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-sm text-gray-500">Supabase ID</dt>
            <dd class="text-sm font-mono text-gray-900 truncate max-w-[200px]" title="<%= @user.supabase_id %>">
              <%= @user.supabase_id&.truncate(20) %>
            </dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-sm text-gray-500">Дата регистрации</dt>
            <dd class="text-sm text-gray-900"><%= @user.created_at.strftime('%d.%m.%Y') %></dd>
          </div>
          <div class="flex justify-between">
            <dt class="text-sm text-gray-500">Последняя активность</dt>
            <dd class="text-sm text-gray-900"><%= @user.last_active_at&.strftime('%d.%m.%Y %H:%M') || '—' %></dd>
          </div>
        </dl>
      </div>
    </div>
  </div>
</div>
