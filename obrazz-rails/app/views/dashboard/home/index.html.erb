<% content_for(:title) { 'Obrazz - Личный кабинет' } %>

<!-- Page Header -->
<div class="md:flex md:items-center md:justify-between mb-8">
  <div class="min-w-0 flex-1">
    <h1 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
      Добро пожаловать, <%= current_user.full_name || 'пользователь' %>!
    </h1>
    <p class="mt-1 text-sm text-gray-500">
      Ваш AI-стилист готов к работе
    </p>
  </div>
  <div class="mt-4 flex md:ml-4 md:mt-0">
    <%= link_to dashboard_generations_path, class: "inline-flex items-center rounded-md bg-purple-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-purple-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-purple-600" do %>
      <svg class="-ml-0.5 mr-1.5 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
      </svg>
      Создать генерацию
    <% end %>
  </div>
</div>

<!-- Stats Grid -->
<div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
  <!-- Token Balance -->
  <div class="overflow-hidden rounded-xl bg-white shadow">
    <div class="p-5">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="rounded-lg bg-purple-50 p-3">
            <svg class="h-6 w-6 text-purple-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125" />
            </svg>
          </div>
        </div>
        <div class="ml-5 w-0 flex-1">
          <dl>
            <dt class="truncate text-sm font-medium text-gray-500">Баланс токенов</dt>
            <dd class="text-2xl font-bold text-gray-900"><%= @token_balance %></dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="bg-gray-50 px-5 py-3">
      <%= link_to 'Пополнить', dashboard_tokens_path, class: "text-sm font-medium text-purple-600 hover:text-purple-500" %>
    </div>
  </div>

  <!-- Subscription Status -->
  <div class="overflow-hidden rounded-xl bg-white shadow">
    <div class="p-5">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="rounded-lg <%= @subscription&.pro? ? 'bg-green-50' : 'bg-gray-50' %> p-3">
            <svg class="h-6 w-6 <%= @subscription&.pro? ? 'text-green-600' : 'text-gray-400' %>" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.745 3.745 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.746 3.746 0 011.043 3.296A3.745 3.745 0 0121 12z" />
            </svg>
          </div>
        </div>
        <div class="ml-5 w-0 flex-1">
          <dl>
            <dt class="truncate text-sm font-medium text-gray-500">Подписка</dt>
            <dd>
              <% if @subscription&.pro? %>
                <span class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">
                  Pro
                </span>
              <% else %>
                <span class="inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800">
                  Free
                </span>
              <% end %>
            </dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="bg-gray-50 px-5 py-3">
      <%= link_to (@subscription&.pro? ? 'Управление' : 'Улучшить'), dashboard_subscription_path, class: "text-sm font-medium text-purple-600 hover:text-purple-500" %>
    </div>
  </div>

  <!-- Total Generations -->
  <div class="overflow-hidden rounded-xl bg-white shadow">
    <div class="p-5">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="rounded-lg bg-blue-50 p-3">
            <svg class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
            </svg>
          </div>
        </div>
        <div class="ml-5 w-0 flex-1">
          <dl>
            <dt class="truncate text-sm font-medium text-gray-500">Всего генераций</dt>
            <dd class="text-2xl font-bold text-gray-900"><%= @total_generations %></dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="bg-gray-50 px-5 py-3">
      <span class="text-sm text-gray-500"><%= @successful_generations %> успешных</span>
    </div>
  </div>

  <!-- This Month -->
  <div class="overflow-hidden rounded-xl bg-white shadow">
    <div class="p-5">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <div class="rounded-lg bg-orange-50 p-3">
            <svg class="h-6 w-6 text-orange-600" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
            </svg>
          </div>
        </div>
        <div class="ml-5 w-0 flex-1">
          <dl>
            <dt class="truncate text-sm font-medium text-gray-500">В этом месяце</dt>
            <dd class="text-2xl font-bold text-gray-900"><%= @monthly_generations %></dd>
          </dl>
        </div>
      </div>
    </div>
    <div class="bg-gray-50 px-5 py-3">
      <span class="text-sm text-gray-500"><%= @monthly_tokens_spent %> токенов потрачено</span>
    </div>
  </div>
</div>

<!-- Recent Generations -->
<div class="bg-white shadow rounded-xl overflow-hidden">
  <div class="px-6 py-5 border-b border-gray-200">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold text-gray-900">Последние генерации</h2>
      <%= link_to 'Смотреть все', dashboard_generations_path, class: "text-sm font-medium text-purple-600 hover:text-purple-500" %>
    </div>
  </div>
  
  <% if @recent_generations.any? %>
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 p-6">
      <% @recent_generations.each do |generation| %>
        <%= link_to dashboard_generation_path(generation), class: "group relative" do %>
          <div class="aspect-square w-full overflow-hidden rounded-lg bg-gray-100">
            <% if generation.primary_output_url.present? %>
              <img src="<%= generation.primary_output_url %>" 
                   alt="Generation" 
                   class="h-full w-full object-cover object-center group-hover:opacity-75 transition-opacity">
            <% elsif generation.status == 'processing' %>
              <div class="h-full w-full flex items-center justify-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
              </div>
            <% else %>
              <div class="h-full w-full flex items-center justify-center">
                <svg class="h-10 w-10 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
              </div>
            <% end %>
          </div>
          
          <!-- Status Badge -->
          <div class="absolute top-2 right-2">
            <% case generation.status %>
            <% when 'completed' %>
              <span class="inline-flex items-center rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-800">
                ✓
              </span>
            <% when 'processing' %>
              <span class="inline-flex items-center rounded-full bg-yellow-100 px-2 py-0.5 text-xs font-medium text-yellow-800">
                ...
              </span>
            <% when 'failed' %>
              <span class="inline-flex items-center rounded-full bg-red-100 px-2 py-0.5 text-xs font-medium text-red-800">
                ✗
              </span>
            <% end %>
          </div>
          
          <!-- Type Label -->
          <p class="mt-2 text-xs text-gray-500 truncate">
            <% case generation.generation_type %>
            <% when 'virtual_try_on' %>
              Virtual Try-On
            <% when 'fashion_model' %>
              Fashion Model
            <% when 'variation' %>
              Вариация
            <% else %>
              <%= generation.generation_type&.humanize %>
            <% end %>
          </p>
        <% end %>
      <% end %>
    </div>
  <% else %>
    <div class="p-12 text-center">
      <svg class="mx-auto h-12 w-12 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" />
      </svg>
      <h3 class="mt-2 text-sm font-semibold text-gray-900">Нет генераций</h3>
      <p class="mt-1 text-sm text-gray-500">Создайте свою первую AI-генерацию прямо сейчас!</p>
      <div class="mt-6">
        <%= link_to dashboard_generations_path, class: "inline-flex items-center rounded-md bg-purple-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-purple-500" do %>
          <svg class="-ml-0.5 mr-1.5 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
          </svg>
          Начать генерацию
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<!-- Quick Actions -->
<div class="mt-8 grid grid-cols-1 gap-5 sm:grid-cols-3">
  <!-- Virtual Try-On -->
  <div class="overflow-hidden rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 shadow">
    <div class="p-6 text-white">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <svg class="h-8 w-8 text-white/80" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
          </svg>
        </div>
        <div class="ml-4">
          <h3 class="text-lg font-semibold">Virtual Try-On</h3>
          <p class="text-sm text-white/70">Примерьте вещь на фото</p>
        </div>
      </div>
      <div class="mt-4">
        <%= link_to '#', class: "inline-flex items-center text-sm font-medium text-white hover:text-white/80" do %>
          Попробовать
          <svg class="ml-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Fashion Model -->
  <div class="overflow-hidden rounded-xl bg-gradient-to-br from-blue-500 to-cyan-500 shadow">
    <div class="p-6 text-white">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <svg class="h-8 w-8 text-white/80" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z" />
          </svg>
        </div>
        <div class="ml-4">
          <h3 class="text-lg font-semibold">Fashion Model</h3>
          <p class="text-sm text-white/70">Создайте модель в вашей вещи</p>
        </div>
      </div>
      <div class="mt-4">
        <%= link_to '#', class: "inline-flex items-center text-sm font-medium text-white hover:text-white/80" do %>
          Попробовать
          <svg class="ml-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Variations -->
  <div class="overflow-hidden rounded-xl bg-gradient-to-br from-orange-500 to-red-500 shadow">
    <div class="p-6 text-white">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <svg class="h-8 w-8 text-white/80" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
          </svg>
        </div>
        <div class="ml-4">
          <h3 class="text-lg font-semibold">Вариации</h3>
          <p class="text-sm text-white/70">Генерируйте новые дизайны</p>
        </div>
      </div>
      <div class="mt-4">
        <%= link_to '#', class: "inline-flex items-center text-sm font-medium text-white hover:text-white/80" do %>
          Попробовать
          <svg class="ml-2 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
          </svg>
        <% end %>
      </div>
    </div>
  </div>
</div>
