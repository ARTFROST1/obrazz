<!DOCTYPE html>
<html lang="ru" class="h-full bg-gray-50">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="csrf-param" content="authenticity_token" />
  <meta name="csrf-token" content="<%= form_authenticity_token %>" />
  
  <title><%= content_for(:title) || 'Obrazz - Личный кабинет' %></title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/favicon.png">
  
  <!-- Tailwind CSS -->
  <%= stylesheet_link_tag "tailwind", "inter-font", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  
  <!-- Turbo & Stimulus -->
  <%= javascript_importmap_tags %>
</head>
<body class="h-full">
  <div class="min-h-full">
    <!-- Sidebar (Desktop) -->
    <div class="hidden lg:fixed lg:inset-y-0 lg:z-50 lg:flex lg:w-72 lg:flex-col">
      <div class="flex grow flex-col gap-y-5 overflow-y-auto bg-gray-900 px-6 pb-4">
        <!-- Logo -->
        <div class="flex h-16 shrink-0 items-center">
          <a href="<%= dashboard_root_path %>" class="flex items-center space-x-3">
            <div class="h-10 w-10 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
              <span class="text-white font-bold text-xl">O</span>
            </div>
            <span class="text-white text-xl font-semibold">Obrazz</span>
          </a>
        </div>
        
        <!-- Navigation -->
        <nav class="flex flex-1 flex-col">
          <ul role="list" class="flex flex-1 flex-col gap-y-7">
            <li>
              <ul role="list" class="-mx-2 space-y-1">
                <%= render 'layouts/dashboard/nav_item', 
                    path: dashboard_root_path, 
                    icon: 'home',
                    label: 'Главная' %>
                    
                <%= render 'layouts/dashboard/nav_item', 
                    path: dashboard_generations_path, 
                    icon: 'sparkles',
                    label: 'AI-генерации' %>
                    
                <%= render 'layouts/dashboard/nav_item', 
                    path: dashboard_tokens_path, 
                    icon: 'coins',
                    label: 'Токены' %>
                    
                <%= render 'layouts/dashboard/nav_item', 
                    path: dashboard_subscription_path, 
                    icon: 'credit-card',
                    label: 'Подписка' %>
              </ul>
            </li>
            
            <!-- Settings Section -->
            <li>
              <div class="text-xs font-semibold leading-6 text-gray-400">Настройки</div>
              <ul role="list" class="-mx-2 mt-2 space-y-1">
                <%= render 'layouts/dashboard/nav_item', 
                    path: dashboard_settings_path, 
                    icon: 'cog',
                    label: 'Профиль' %>
              </ul>
            </li>
            
            <!-- User Profile -->
            <li class="mt-auto">
              <div class="flex items-center gap-x-4 px-2 py-3 text-sm font-semibold leading-6 text-white">
                <% if current_user&.avatar_url.present? %>
                  <img class="h-10 w-10 rounded-full bg-gray-800" 
                       src="<%= current_user.avatar_url %>" 
                       alt="<%= current_user.full_name || current_user.email %>">
                <% else %>
                  <div class="h-10 w-10 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
                    <span class="text-white font-medium">
                      <%= (current_user&.full_name || current_user&.email || 'U').first.upcase %>
                    </span>
                  </div>
                <% end %>
                <span class="sr-only">Ваш профиль</span>
                <div class="flex-1 min-w-0">
                  <p class="truncate"><%= current_user&.full_name || 'Пользователь' %></p>
                  <p class="truncate text-xs text-gray-400"><%= current_user&.email %></p>
                </div>
                <%= link_to logout_path, method: :delete, class: "text-gray-400 hover:text-white", data: { turbo_method: :delete } do %>
                  <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9" />
                  </svg>
                <% end %>
              </div>
            </li>
          </ul>
        </nav>
      </div>
    </div>

    <!-- Mobile Header -->
    <div class="lg:hidden">
      <div class="sticky top-0 z-40 flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6">
        <!-- Mobile menu button -->
        <button type="button" 
                class="-m-2.5 p-2.5 text-gray-700" 
                data-controller="mobile-menu"
                data-action="click->mobile-menu#toggle">
          <span class="sr-only">Открыть меню</span>
          <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </button>
        
        <!-- Logo -->
        <a href="<%= dashboard_root_path %>" class="flex items-center space-x-2">
          <div class="h-8 w-8 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
            <span class="text-white font-bold">O</span>
          </div>
          <span class="font-semibold text-gray-900">Obrazz</span>
        </a>
        
        <!-- Token Balance (Mobile) -->
        <div class="ml-auto flex items-center gap-x-2">
          <div class="flex items-center space-x-1 bg-purple-50 px-3 py-1.5 rounded-full">
            <svg class="h-4 w-4 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6c.304 0 .792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95c-.285.475-.507 1-.67 1.55H6a1 1 0 000 2h.013a9.358 9.358 0 000 1H6a1 1 0 100 2h.351c.163.55.385 1.075.67 1.55C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 10-1.715-1.029c-.472.786-.96.979-1.264.979-.304 0-.792-.193-1.264-.979a4.265 4.265 0 01-.264-.521H10a1 1 0 100-2H8.017a7.36 7.36 0 010-1H10a1 1 0 100-2H8.472c.08-.185.167-.36.264-.521z"/>
            </svg>
            <span class="text-sm font-medium text-purple-700"><%= current_user&.available_tokens || 0 %></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="lg:pl-72">
      <!-- Top bar (Desktop) -->
      <div class="sticky top-0 z-40 hidden lg:flex h-16 shrink-0 items-center gap-x-4 border-b border-gray-200 bg-white px-4 shadow-sm sm:gap-x-6 sm:px-6 lg:px-8">
        <div class="flex flex-1 gap-x-4 self-stretch lg:gap-x-6">
          <div class="relative flex flex-1"></div>
          
          <!-- Token Balance -->
          <div class="flex items-center gap-x-4 lg:gap-x-6">
            <%= link_to dashboard_tokens_path, class: "flex items-center space-x-2 bg-purple-50 hover:bg-purple-100 px-4 py-2 rounded-full transition-colors" do %>
              <svg class="h-5 w-5 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6c.304 0 .792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95c-.285.475-.507 1-.67 1.55H6a1 1 0 000 2h.013a9.358 9.358 0 000 1H6a1 1 0 100 2h.351c.163.55.385 1.075.67 1.55C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 10-1.715-1.029c-.472.786-.96.979-1.264.979-.304 0-.792-.193-1.264-.979a4.265 4.265 0 01-.264-.521H10a1 1 0 100-2H8.017a7.36 7.36 0 010-1H10a1 1 0 100-2H8.472c.08-.185.167-.36.264-.521z"/>
              </svg>
              <span class="text-sm font-semibold text-purple-700"><%= current_user&.available_tokens || 0 %> токенов</span>
            <% end %>
            
            <!-- Separator -->
            <div class="hidden lg:block lg:h-6 lg:w-px lg:bg-gray-200"></div>
            
            <!-- Profile Dropdown -->
            <div class="relative" data-controller="dropdown">
              <button type="button" 
                      class="flex items-center gap-x-2 text-sm"
                      data-action="click->dropdown#toggle">
                <% if current_user&.avatar_url.present? %>
                  <img class="h-8 w-8 rounded-full bg-gray-50" 
                       src="<%= current_user.avatar_url %>" 
                       alt="">
                <% else %>
                  <div class="h-8 w-8 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
                    <span class="text-white text-sm font-medium">
                      <%= (current_user&.full_name || current_user&.email || 'U').first.upcase %>
                    </span>
                  </div>
                <% end %>
                <span class="hidden lg:flex lg:items-center">
                  <span class="text-sm font-semibold text-gray-900"><%= current_user&.full_name || 'Пользователь' %></span>
                  <svg class="ml-2 h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                  </svg>
                </span>
              </button>
              
              <!-- Dropdown menu -->
              <div class="hidden absolute right-0 z-10 mt-2.5 w-48 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-gray-900/5 focus:outline-none"
                   data-dropdown-target="menu">
                <%= link_to 'Настройки', dashboard_settings_path, class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50" %>
                <%= link_to 'Выйти', logout_path, method: :delete, class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50", data: { turbo_method: :delete } %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Page Content -->
      <div class="py-10">
        <div class="px-4 sm:px-6 lg:px-8">
          <!-- Flash Messages -->
          <% if notice.present? %>
            <div class="mb-6 rounded-md bg-green-50 p-4" data-controller="alert" data-alert-dismiss-after-value="5000">
              <div class="flex">
                <div class="flex-shrink-0">
                  <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                  </svg>
                </div>
                <div class="ml-3">
                  <p class="text-sm font-medium text-green-800"><%= notice %></p>
                </div>
                <div class="ml-auto pl-3">
                  <button type="button" class="inline-flex rounded-md bg-green-50 p-1.5 text-green-500 hover:bg-green-100" data-action="click->alert#dismiss">
                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          <% end %>
          
          <% if alert.present? %>
            <div class="mb-6 rounded-md bg-red-50 p-4" data-controller="alert">
              <div class="flex">
                <div class="flex-shrink-0">
                  <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                  </svg>
                </div>
                <div class="ml-3">
                  <p class="text-sm font-medium text-red-800"><%= alert %></p>
                </div>
                <div class="ml-auto pl-3">
                  <button type="button" class="inline-flex rounded-md bg-red-50 p-1.5 text-red-500 hover:bg-red-100" data-action="click->alert#dismiss">
                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          <% end %>
          
          <%= yield %>
        </div>
      </div>
    </main>
  </div>
  
  <!-- Mobile Menu Overlay -->
  <div id="mobile-menu" class="hidden relative z-50 lg:hidden" role="dialog" aria-modal="true">
    <div class="fixed inset-0 bg-gray-900/80"></div>
    <div class="fixed inset-0 flex">
      <div class="relative mr-16 flex w-full max-w-xs flex-1">
        <div class="absolute left-full top-0 flex w-16 justify-center pt-5">
          <button type="button" class="-m-2.5 p-2.5" data-action="click->mobile-menu#close">
            <span class="sr-only">Закрыть меню</span>
            <svg class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        
        <div class="flex grow flex-col gap-y-5 overflow-y-auto bg-gray-900 px-6 pb-4 ring-1 ring-white/10">
          <div class="flex h-16 shrink-0 items-center">
            <div class="h-10 w-10 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
              <span class="text-white font-bold text-xl">O</span>
            </div>
            <span class="ml-3 text-white text-xl font-semibold">Obrazz</span>
          </div>
          <nav class="flex flex-1 flex-col">
            <ul role="list" class="flex flex-1 flex-col gap-y-7">
              <li>
                <ul role="list" class="-mx-2 space-y-1">
                  <%= render 'layouts/dashboard/nav_item_mobile', path: dashboard_root_path, icon: 'home', label: 'Главная' %>
                  <%= render 'layouts/dashboard/nav_item_mobile', path: dashboard_generations_path, icon: 'sparkles', label: 'AI-генерации' %>
                  <%= render 'layouts/dashboard/nav_item_mobile', path: dashboard_tokens_path, icon: 'coins', label: 'Токены' %>
                  <%= render 'layouts/dashboard/nav_item_mobile', path: dashboard_subscription_path, icon: 'credit-card', label: 'Подписка' %>
                  <%= render 'layouts/dashboard/nav_item_mobile', path: dashboard_settings_path, icon: 'cog', label: 'Настройки' %>
                </ul>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
